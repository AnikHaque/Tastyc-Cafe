{% extends "accounts/dashboard/base_dashboard.html" %}
{% block sidebar %}
    {% url 'staff_analytics' as a %}{% url 'staff_inventory' as i %}{% url 'staff_top_selling' as t %}{% url 'staff_dashboard' as d %}{% url 'staff_blog_list' as bl %}{% url 'staff_create_blog' as bc %}
    <a href="{{ a }}" class="{% if request.path == a %}active{% endif %}"><i class="fa-solid fa-chart-pie me-2"></i> Analytics</a>
    <a href="{{ i }}" class="{% if request.path == i %}active{% endif %}"><i class="fa-solid fa-boxes-stacked me-2"></i> Inventory</a>
    <a href="{{ t }}" class="{% if request.path == t %}active{% endif %}"><i class="fa-solid fa-fire me-2"></i> Top Selling</a>
    <a href="{{ d }}" class="{% if request.path == d and not request.GET.payment and not request.GET.status %}active{% endif %}"><i class="fa-solid fa-receipt me-2"></i> All Orders</a>
    <a href="{{ d }}?payment=PAID" class="{% if request.GET.payment == 'PAID' %}active{% endif %}"><i class="fa-solid fa-circle-check me-2"></i> Paid Orders</a>
    <a href="{{ d }}?status=PENDING" class="{% if request.GET.status == 'PENDING' %}active{% endif %}"><i class="fa-solid fa-clock me-2"></i> New Orders</a>
    <hr class="opacity-10 mx-3">
    <a href="{{ bl }}" class="{% if request.path == bl %}active{% endif %}"><i class="fa-solid fa-newspaper me-2"></i> Blogs</a>
    <a href="{{ bc }}" class="{% if request.path == bc %}active{% endif %} text-warning fw-bold"><i class="fa-solid fa-plus-circle me-2"></i> Create</a>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <h3 class="fw-bold mb-4">
        {% if request.resolver_match.url_name == 'staff_analytics' %}<i class="fa-solid fa-chart-line me-2"></i> Analytics Dashboard
        {% else %}<i class="fa-solid fa-list-check me-2"></i> Order Management <small class="text-muted fs-6">{% if request.GET.payment %}({{ request.GET.payment }}){% endif %} {% if request.GET.status %}({{ request.GET.status }}){% endif %}</small>{% endif %}
    </h3>
    <div class="row g-3 mb-4">
        <div class="col-md-3"><div class="card p-3 border-0 shadow-sm text-center"><h6 class="text-muted small text-uppercase">Total</h6><h3 class="fw-bold mb-0">{{ total_orders }}</h3></div></div>
        <div class="col-md-3"><div class="card p-3 border-0 shadow-sm text-center bg-success text-white"><h6 class="opacity-75 small text-uppercase">Paid</h6><h3 class="fw-bold mb-0">{{ total_paid }}</h3></div></div>
        <div class="col-md-3"><div class="card p-3 border-0 shadow-sm text-center bg-warning"><h6 class="opacity-75 small text-uppercase">Unpaid</h6><h3 class="fw-bold mb-0">{{ total_pending }}</h3></div></div>
        <div class="col-md-3"><div class="card p-3 border-0 shadow-sm text-center bg-info text-white"><h6 class="opacity-75 small text-uppercase">Revenue</h6><h3 class="fw-bold mb-0">৳{{ total_revenue|floatformat:0 }}</h3></div></div>
    </div>
    {% if request.resolver_match.url_name == 'staff_analytics' %}{% include "accounts/dashboard/includes/charts.html" %}
    {% else %}
    <div class="card border-0 shadow-sm rounded-4 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light small text-uppercase"><tr><th class="ps-4">ID</th><th>Customer</th><th>Amount</th><th>Status</th><th>Date</th><th class="text-end pe-4">Action</th></tr></thead>
                <tbody class="small">
                    {% for order in orders %}
                    <tr>
                        <td class="ps-4 fw-bold">#{{ order.id }}</td>
                        <td><div class="fw-bold">{{ order.full_name }}</div><small class="text-muted">{{ order.phone }}</small></td>
                        <td>৳{{ order.total_price }}</td>
                        <td><span class="badge {% if order.is_paid %}bg-success-light text-success{% else %}bg-danger-light text-danger{% endif %}">{{ order.is_paid|yesno:"Paid,Unpaid" }}</span>
                            <span class="badge bg-warning-light text-warning ms-1">{{ order.get_status_display }}</span></td>
                        <td>{{ order.created_at|date:"d M, Y" }}</td>
                        <td class="text-end pe-4">
                            {% if not order.is_paid or order.status == 'PENDING' %}<a href="{% url 'mark_paid' order.id %}" class="btn btn-sm btn-success rounded-pill px-3 shadow-sm">Cook</a>{% endif %}
                            <a href="{% url 'track_order' order.id %}" class="btn btn-sm btn-outline-dark rounded-pill px-3 ms-1">Details</a>
                        </td>
                    </tr>
                    {% empty %}<tr><td colspan="6" class="text-center py-5 text-muted">No orders available.</td></tr>{% endfor %}
                </tbody>
            </table>
        </div>
    </div>{% endif %}
</div>
<style>
    .bg-success-light{background:#d1e7dd}.bg-warning-light{background:#fff3cd}.bg-danger-light{background:#f8d7da}
    .badge{font-weight:600;font-size:.7rem;border-radius:4px;padding:4px 8px}.table thead th{border:none;color:#6c757d;padding:15px 10px}
    .table tbody td{padding:12px 10px;border-bottom:1px solid #f8f9fa}
</style>
{% endblock %}
{% extends 'base.html' %}
{% load static %}
{% block title %}Our Exquisite Menu | RoyalDine Luxury{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/menu.css' %}">

<header class="menu-header text-center">
    <div class="container">
        <p class="text-uppercase fw-bold text-warning ls-2" style="letter-spacing: 5px;">Luxury Dining</p>
        <h1 class="display-3 fw-bold playfair">Our Exquisite Menu</h1>
    </div>
</header>

<div class="container menu-controls text-center mt-4">
    <form method="GET" action="{% url 'menu' %}" class="search-bar mx-auto">
        <i class="fa-solid fa-magnifying-glass text-muted fs-5"></i>
        <input type="text" name="search" placeholder="What are you craving today?" value="{{ request.GET.search|default:'' }}">
        <button type="submit" class="btn btn-danger rounded-pill px-4 fw-bold">Search</button>
    </form>
    <div class="filter-pills my-4">
        <a href="{% url 'menu' %}" class="filter-pill {% if not request.GET.category %}active{% endif %}">All Dishes</a>
        {% for cat in categories %}<a href="?category={{ cat.name|slugify }}" class="filter-pill {% if request.GET.category == cat.name|slugify %}active{% endif %}">{{ cat.name }}</a>{% endfor %}
    </div>
</div>

<div class="container pb-5">
    <div class="row g-4">
        {% for food in foods %}
        <div class="col-xl-3 col-lg-4 col-md-6">
            <div class="food-card h-100 d-flex flex-column position-relative shadow-sm border-0 rounded-4 overflow-hidden">
                {% if food.is_low_stock %}<div class="position-absolute top-0 start-0 m-3 z-index-2"><span class="badge bg-danger rounded-pill px-3 shadow animate__animated animate__pulse animate__infinite">ðŸ”¥ Selling Fast! {{ food.stock }} Left</span></div>{% endif %}
                <div class="price-tag shadow">
                    {% if food.get_dynamic_price < food.price %}<small class="text-decoration-line-through opacity-75 me-1" style="font-size: 0.75rem;">à§³{{ food.price }}</small><span>à§³{{ food.get_dynamic_price|floatformat:0 }}</span>
                    {% else %}à§³{{ food.price|floatformat:0 }}{% endif %}
                </div>
                <div class="img-wrapper" style="height: 230px; overflow: hidden;"><img src="{{ food.image.url }}" class="w-100 h-100 object-fit-cover transition" alt="{{ food.name }}"></div>
                <div class="p-4 flex-grow-1 d-flex flex-column text-center">
                    <div class="mb-1"><span class="badge bg-light text-muted fw-normal rounded-pill" style="font-size: 10px;">{{ food.category.name }}</span></div>
                    <h5 class="fw-bold mb-2">{{ food.name }}</h5>
                    {% if food.get_dynamic_price < food.price %}<p class="text-success small fw-bold mb-2"><i class="fa-solid fa-clock"></i> Happy Hour Price!</p>{% endif %}
                    <p class="text-muted small flex-grow-1">{{ food.description|truncatechars:60 }}</p>
                    <div class="d-flex align-items-center gap-2 mt-3">
                        <a href="{% url 'toggle_wishlist' food.id %}" class="wishlist-btn border rounded-circle p-2">{% if food.id|stringformat:"s" in request.session.wishlist %}<i class="fa-solid fa-heart text-danger"></i>{% else %}<i class="fa-regular fa-heart"></i>{% endif %}</a>
                        {% if food.stock > 0 %}<a href="{% url 'add_to_cart' food.id %}" class="btn btn-danger flex-grow-1 rounded-pill fw-bold py-2 shadow-sm"><i class="fa-solid fa-basket-shopping me-2"></i> ADD TO CART</a>
                        {% else %}<button class="btn btn-secondary flex-grow-1 rounded-pill fw-bold py-2 shadow-sm cursor-not-allowed" disabled>SOLD OUT</button>{% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% empty %}<div class="col-12 text-center py-5"><h3>No delicious items found.</h3><a href="{% url 'menu' %}" class="btn btn-outline-danger mt-2 rounded-pill px-4">View All Menu</a></div>{% endfor %}
    </div>
    {% if foods.has_other_pages %}
    <nav class="mt-5"><ul class="pagination justify-content-center">
        {% if foods.has_previous %}<li class="page-item"><a class="page-link shadow-sm rounded-circle mx-1" href="?page={{ foods.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"><i class="fa-solid fa-chevron-left"></i></a></li>{% endif %}
        {% for i in foods.paginator.page_range %}{% if foods.number == i %}<li class="page-item active"><span class="page-link rounded-circle mx-1 shadow">{{ i }}</span></li>
        {% elif i > foods.number|add:'-3' and i < foods.number|add:'3' %}<li class="page-item"><a class="page-link rounded-circle mx-1 shadow-sm" href="?page={{ i }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}">{{ i }}</a></li>{% endif %}{% endfor %}
        {% if foods.has_next %}<li class="page-item"><a class="page-link shadow-sm rounded-circle mx-1" href="?page={{ foods.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}"><i class="fa-solid fa-chevron-right"></i></a></li>{% endif %}
    </ul></nav>{% endif %}
</div>
{% endblock %}